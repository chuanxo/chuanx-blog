{{- define "main" -}}
<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">{{ .Title }}</h1>
    {{- if .Description }}
    <p class="post-description">{{ .Description }}</p>
    {{- end }}
  </header>

  <div class="post-content">
    {{ .Content }}
  </div>

  {{- /* 照片网格 */ -}}
  <div class="gallery-photos" itemscope itemtype="http://schema.org/ImageGallery">
    {{- $photos := .Params.photos }}
    {{- range $index, $photo := $photos }}
    <figure class="gallery-photo" itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
      <a href="{{ $photo.url }}" itemprop="contentUrl" data-size="1600x1200" data-pswp-width="1600" data-pswp-height="1200">
        <img src="{{ $photo.url }}" alt="Photo" itemprop="thumbnail" loading="lazy">
      </a>
    </figure>
    {{- end }}
  </div>

  <div class="gallery-back">
    <a href="/gallery/">← 返回图册</a>
  </div>
</article>

{{- /* PhotoSwipe 灯箱 */ -}}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.css">
<script type="module">
  import PhotoSwipe from 'https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.esm.min.js';
  import PhotoSwipeLightbox from 'https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '.gallery-photos',
    children: 'a',
    pswpModule: PhotoSwipe
  });
  lightbox.init();
</script>

<style>
.gallery-photos {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 0.5rem;
  margin-top: 2rem;
}

.gallery-photo {
  margin: 0;
  aspect-ratio: 1;
  overflow: hidden;
  border-radius: 4px;
}

.gallery-photo a {
  display: block;
  width: 100%;
  height: 100%;
}

.gallery-photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  cursor: zoom-in;
  transition: transform 0.2s;
}

.gallery-photo:hover img {
  transform: scale(1.05);
}

.gallery-back {
  margin-top: 2rem;
}

.gallery-back a {
  color: var(--theme-text-secondary, #666);
  text-decoration: none;
}

.gallery-back a:hover {
  text-decoration: underline;
}

/* 响应式调整 */
@media (max-width: 600px) {
  .gallery-photos {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 0.25rem;
  }
}
</style>
{{- end -}}
